{"version":3,"names":[],"mappings":"","sources":["what-input.js"],"sourcesContent":[";(function(root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define([], function() {\n      return (factory());\n    });\n  } else if (typeof exports === 'object') {\n    module.exports = factory();\n  } else {\n    root.whatInput = factory();\n  }\n} (this, function() {\n  'use strict';\n\n\n  /*\n    ---------------\n    variables\n    ---------------\n  */\n\n  // array of actively pressed keys\n  var activeKeys = [];\n\n  // cache document.body\n  var body = document.body;\n\n  // boolean: true if touch buffer timer is running\n  var buffer = false;\n\n  // the last used input type\n  var currentInput = null;\n\n  // array of form elements that take keyboard input\n  var formInputs = [\n    'input',\n    'select',\n    'textarea'\n  ];\n\n  // user-set flag to allow typing in form fields to be recorded\n  var formTyping = body.hasAttribute('data-whatinput-formtyping');\n\n  // mapping of events to input types\n  var inputMap = {\n    'keydown': 'keyboard',\n    'mousedown': 'mouse',\n    'mouseenter': 'mouse',\n    'touchstart': 'touch',\n    'pointerdown': 'pointer',\n    'MSPointerDown': 'pointer'\n  };\n\n  // array of all used input types\n  var inputTypes = [];\n\n  // mapping of key codes to common name\n  var keyMap = {\n    9: 'tab',\n    13: 'enter',\n    16: 'shift',\n    27: 'esc',\n    32: 'space',\n    37: 'left',\n    38: 'up',\n    39: 'right',\n    40: 'down'\n  };\n\n  // map of IE 10 pointer events\n  var pointerMap = {\n    2: 'touch',\n    3: 'touch', // treat pen like touch\n    4: 'mouse'\n  };\n\n  // touch buffer timer\n  var timer;\n\n\n  /*\n    ---------------\n    functions\n    ---------------\n  */\n\n  function bufferInput(event) {\n    clearTimeout(timer);\n\n    setInput(event);\n\n    buffer = true;\n    timer = setTimeout(function() {\n      buffer = false;\n    }, 1000);\n  }\n\n  function immediateInput(event) {\n    if (!buffer) setInput(event);\n  }\n\n  function setInput(event) {\n    var eventKey = key(event);\n    var eventTarget = target(event);\n    var value = inputMap[event.type];\n    if (value === 'pointer') value = pointerType(event);\n\n    if (currentInput !== value) {\n      if (\n        // only if the user flag isn't set\n        !formTyping &&\n\n        // only if currentInput has a value\n        currentInput &&\n\n        // only if the input is `keyboard`\n        value === 'keyboard' &&\n\n        // not if the key is `TAB`\n        keyMap[eventKey] !== 'tab' &&\n\n        // only if the target is one of the elements in `formInputs`\n        formInputs.indexOf(eventTarget.nodeName.toLowerCase()) >= 0\n      ) {\n        // ignore keyboard typing on form elements\n      } else {\n        currentInput = value;\n        body.setAttribute('data-whatinput', currentInput);\n\n        if (inputTypes.indexOf(currentInput) === -1) inputTypes.push(currentInput);\n      }\n    }\n\n    if (value === 'keyboard') logKeys(eventKey);\n  }\n\n  function key(event) {\n    return (event.keyCode) ? event.keyCode : event.which;\n  }\n\n  function target(event) {\n    return event.target || event.srcElement;\n  }\n\n  function pointerType(event) {\n    return (typeof event.pointerType === 'number') ? pointerMap[event.pointerType] : event.pointerType;\n  }\n\n  // keyboard logging\n  function logKeys(eventKey) {\n    if (activeKeys.indexOf(keyMap[eventKey]) === -1 && keyMap[eventKey]) activeKeys.push(keyMap[eventKey]);\n  }\n\n  function unLogKeys(event) {\n    var eventKey = key(event);\n    var arrayPos = activeKeys.indexOf(keyMap[eventKey]);\n\n    if (arrayPos !== -1) activeKeys.splice(arrayPos, 1);\n  }\n\n  function bindEvents() {\n\n    // pointer/mouse\n    var mouseEvent = 'mousedown';\n\n    if (window.PointerEvent) {\n      mouseEvent = 'pointerdown';\n    } else if (window.MSPointerEvent) {\n      mouseEvent = 'MSPointerDown';\n    }\n\n    body.addEventListener(mouseEvent, immediateInput);\n    body.addEventListener('mouseenter', immediateInput);\n\n    // touch\n    if ('ontouchstart' in window) {\n      body.addEventListener('touchstart', bufferInput);\n    }\n\n    // keyboard\n    body.addEventListener('keydown', immediateInput);\n    document.addEventListener('keyup', unLogKeys);\n  }\n\n\n  /*\n    ---------------\n    init\n\n    don't start script unless browser cuts the mustard,\n    also passes if polyfills are used\n    ---------------\n  */\n\n  if ('addEventListener' in window && Array.prototype.indexOf) {\n    bindEvents();\n  }\n\n\n  /*\n    ---------------\n    api\n    ---------------\n  */\n\n  return {\n\n    // returns string: the current input type\n    ask: function() { return currentInput; },\n\n    // returns array: currently pressed keys\n    keys: function() { return activeKeys; },\n\n    // returns array: all the detected input types\n    types: function() { return inputTypes; },\n\n    // accepts string: manually set the input type\n    set: setInput\n  };\n\n}));\n"],"file":"what-input.js","sourceRoot":"/source/"}